"use strict";(()=>{var e={};e.id=777,e.ids=[777],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6251:(e,i,t)=>{t.r(i),t.d(i,{originalPathname:()=>v,patchFetch:()=>b,requestAsyncStorage:()=>f,routeModule:()=>m,serverHooks:()=>y,staticGenerationAsyncStorage:()=>h});var r={};t.r(r),t.d(r,{GET:()=>p,POST:()=>u});var n=t(9303),o=t(8716),a=t(670);let s={thresholds:{dtiHigh:.4,affordability:{rentRule:3,partialCreditRatio:2.5,dtiMitigation:.36,dtiException:.3},credit:{excellentMin:750,goodMin:650}},scoring:{dtiHigh:2,affordability:{meetsRule:0,partialCredit:1,dtiException:2,fail:4},credit:{excellent:0,good:1,poor:2},rental:{evictionPoints:3,latePaymentsThreshold:3,latePaymentsPoints:2},criminal:{hasRecordPoints:3},employment:{fullTime:0,partTime:1,unemployed:2},qualitative:{landlord:{strong:0,positive:.5,neutral:1,concern:3,unverifiedPenalty:.5,missing:1.5},paymentHistory:{excellentMin:.95,goodMin:.85,fairMin:.7,excellent:0,good:.5,fair:1.5,poor:3,missing:1.5}}},decision:{approvedMax:5.5,flaggedMax:5.75}},l=[],d=require("crypto");function c(e){let i="string"==typeof e?Number(e):e;return Number.isFinite(i)?i:void 0}async function u(e){try{var i;let t=await e.json(),r=function(e){let i=[],t=c(e?.income),r=c(e?.monthly_rent),n=c(e?.debt),o=c(e?.credit_score);(void 0===t||t<0)&&i.push("income must be a non-negative number"),(void 0===r||r<0)&&i.push("monthly_rent must be a non-negative number"),(void 0===n||n<0)&&i.push("debt must be a non-negative number"),(void 0===o||o<300||o>850)&&i.push("credit_score must be a number between 300 and 850");let a=e?.rental_history??{},s=c(a?.evictions),l=c(a?.late_payments);(void 0===s||s<0)&&i.push("rental_history.evictions must be a non-negative number"),(void 0===l||l<0)&&i.push("rental_history.late_payments must be a non-negative number");let d=e?.criminal_background??{},u=!!d?.has_criminal_record,p=d?.type_of_crime,g=e?.landlord_reference??{},m=["strong","positive","neutral","concern"],f=g?.rating,h=g?.verified,y=g?.references_provided;m.includes(f)||i.push(`landlord_reference.rating must be one of: ${m.join(", ")}`),"boolean"!=typeof h&&i.push("landlord_reference.verified must be a boolean"),void 0!==y&&(!Number.isInteger(y)||y<0)&&i.push("landlord_reference.references_provided must be a non-negative integer when supplied");let v=e?.payment_history??{},b=c(v?.on_time_rate),_=v?.records_available;(void 0===b||b<0||b>1)&&i.push("payment_history.on_time_rate must be a number between 0 and 1"),"boolean"!=typeof _&&i.push("payment_history.records_available must be a boolean");let x=e?.employment_status,M=["full-time","part-time","unemployed"];return(M.includes(x)||i.push(`employment_status must be one of: ${M.join(", ")}`),i.length)?{ok:!1,errors:i}:{ok:!0,data:{income:t,monthly_rent:r,debt:n,credit_score:o,rental_history:{evictions:s,late_payments:l},criminal_background:{has_criminal_record:u,type_of_crime:"string"==typeof p?p:null},employment_status:x,landlord_reference:{rating:f,verified:h,references_provided:y},payment_history:{on_time_rate:b,records_available:_}}}}(t);if(!r.ok)return Response.json({errors:r.errors},{status:400});let n=function(e){let i=[];if(!e||"object"!=typeof e)return{value:s,errors:i};let t=JSON.parse(JSON.stringify(s));if(e.thresholds){if(g(e.thresholds.dtiHigh)&&(t.thresholds.dtiHigh=e.thresholds.dtiHigh),e.thresholds.affordability){let i=e.thresholds.affordability;g(i.rentRule)&&(t.thresholds.affordability.rentRule=i.rentRule),g(i.partialCreditRatio)&&(t.thresholds.affordability.partialCreditRatio=i.partialCreditRatio),g(i.dtiMitigation)&&(t.thresholds.affordability.dtiMitigation=i.dtiMitigation),g(i.dtiException)&&(t.thresholds.affordability.dtiException=i.dtiException)}if(e.thresholds.credit){let i=e.thresholds.credit;g(i.excellentMin)&&(t.thresholds.credit.excellentMin=i.excellentMin),g(i.goodMin)&&(t.thresholds.credit.goodMin=i.goodMin)}}if(e.scoring){if(g(e.scoring.dtiHigh)&&(t.scoring.dtiHigh=e.scoring.dtiHigh),e.scoring.affordability){let i=e.scoring.affordability;g(i.meetsRule)&&(t.scoring.affordability.meetsRule=i.meetsRule),g(i.partialCredit)&&(t.scoring.affordability.partialCredit=i.partialCredit),g(i.dtiException)&&(t.scoring.affordability.dtiException=i.dtiException),g(i.fail)&&(t.scoring.affordability.fail=i.fail)}if(e.scoring.credit){let i=e.scoring.credit;g(i.excellent)&&(t.scoring.credit.excellent=i.excellent),g(i.good)&&(t.scoring.credit.good=i.good),g(i.poor)&&(t.scoring.credit.poor=i.poor)}if(e.scoring.rental){let i=e.scoring.rental;g(i.evictionPoints)&&(t.scoring.rental.evictionPoints=i.evictionPoints),g(i.latePaymentsThreshold)&&(t.scoring.rental.latePaymentsThreshold=i.latePaymentsThreshold),g(i.latePaymentsPoints)&&(t.scoring.rental.latePaymentsPoints=i.latePaymentsPoints)}if(e.scoring.criminal){let i=e.scoring.criminal;g(i.hasRecordPoints)&&(t.scoring.criminal.hasRecordPoints=i.hasRecordPoints)}if(e.scoring.employment){let i=e.scoring.employment;g(i.fullTime)&&(t.scoring.employment.fullTime=i.fullTime),g(i.partTime)&&(t.scoring.employment.partTime=i.partTime),g(i.unemployed)&&(t.scoring.employment.unemployed=i.unemployed)}if(e.scoring.qualitative){let i=e.scoring.qualitative;if(i.landlord){let e=i.landlord;g(e.strong)&&(t.scoring.qualitative.landlord.strong=e.strong),g(e.positive)&&(t.scoring.qualitative.landlord.positive=e.positive),g(e.neutral)&&(t.scoring.qualitative.landlord.neutral=e.neutral),g(e.concern)&&(t.scoring.qualitative.landlord.concern=e.concern),g(e.unverifiedPenalty)&&(t.scoring.qualitative.landlord.unverifiedPenalty=e.unverifiedPenalty),g(e.missing)&&(t.scoring.qualitative.landlord.missing=e.missing)}if(i.paymentHistory){let e=i.paymentHistory;g(e.excellentMin)&&(t.scoring.qualitative.paymentHistory.excellentMin=e.excellentMin),g(e.goodMin)&&(t.scoring.qualitative.paymentHistory.goodMin=e.goodMin),g(e.fairMin)&&(t.scoring.qualitative.paymentHistory.fairMin=e.fairMin),g(e.excellent)&&(t.scoring.qualitative.paymentHistory.excellent=e.excellent),g(e.good)&&(t.scoring.qualitative.paymentHistory.good=e.good),g(e.fair)&&(t.scoring.qualitative.paymentHistory.fair=e.fair),g(e.poor)&&(t.scoring.qualitative.paymentHistory.poor=e.poor),g(e.missing)&&(t.scoring.qualitative.paymentHistory.missing=e.missing)}}}return e.decision&&(g(e.decision.approvedMax)&&(t.decision.approvedMax=e.decision.approvedMax),g(e.decision.flaggedMax)&&(t.decision.flaggedMax=e.decision.flaggedMax)),t.thresholds.credit.goodMin<=t.thresholds.credit.excellentMin||i.push("thresholds.credit.goodMin must be <= thresholds.credit.excellentMin"),t.decision.approvedMax<=t.decision.flaggedMax||i.push("decision.approvedMax must be <= decision.flaggedMax"),t.thresholds.dtiHigh>=0||i.push("thresholds.dtiHigh must be >= 0"),t.thresholds.affordability.partialCreditRatio<=t.thresholds.affordability.rentRule||i.push("thresholds.affordability.partialCreditRatio must be <= thresholds.affordability.rentRule"),t.thresholds.affordability.dtiException<=t.thresholds.affordability.dtiMitigation||i.push("thresholds.affordability.dtiException must be <= thresholds.affordability.dtiMitigation"),{value:t,errors:i}}(t?.config);if(n.errors.length)return Response.json({errors:n.errors},{status:400});let{risk_score:o,decision:a}=function(e,i=s){let t=function(e,i=s){var t,r,n;let o,a=0,l=function(e,i,t,r=s){let n=t>0?e/12/t:1/0,o=e<=0?1/0:i/e,a=r.thresholds.affordability,l=r.scoring.affordability;return Number.isFinite(n)&&n!==1/0?n>=a.rentRule?{ratio:n,dti:o,tier:"meets-rule",risk:l.meetsRule}:n>=a.partialCreditRatio&&o<=a.dtiMitigation?{ratio:n,dti:o,tier:"partial-credit",risk:l.partialCredit}:o<=a.dtiException?{ratio:n,dti:o,tier:"dti-exception",risk:l.dtiException}:{ratio:n,dti:o,tier:"fail",risk:l.fail}:{ratio:1/0,dti:o,tier:"meets-rule",risk:l.meetsRule}}(e.income,e.debt,e.monthly_rent,i);return a+=l.risk,l.dti>i.thresholds.dtiHigh&&(a+=i.scoring.dtiHigh),a+=function(e,i){if(i){let{excellentMin:t,goodMin:r}=i.thresholds.credit;return e>=t?i.scoring.credit.excellent:e>=r?i.scoring.credit.good:i.scoring.credit.poor}return e>=750?0:e>=650?1:2}(e.credit_score,i)+(t=e.rental_history,o=0,i?(t.evictions>0&&(o+=i.scoring.rental.evictionPoints),t.late_payments>i.scoring.rental.latePaymentsThreshold&&(o+=i.scoring.rental.latePaymentsPoints)):(t.evictions>0&&(o+=3),t.late_payments>3&&(o+=2)),o)+(r=e.criminal_background,i?r.has_criminal_record?i.scoring.criminal.hasRecordPoints:0:r.has_criminal_record?3:0)+(n=e.employment_status,i?"full-time"===n?i.scoring.employment.fullTime:"part-time"===n?i.scoring.employment.partTime:i.scoring.employment.unemployed:"full-time"===n?0:"part-time"===n?1:2)+function(e,i){if(!e)return i?i.scoring.qualitative.landlord.missing:2;if(i){let{landlord:t}=i.scoring.qualitative,r=t[e.rating];return e.verified||(r+=t.unverifiedPenalty),r}let t=0;return t="strong"===e.rating?0:"positive"===e.rating?1:"neutral"===e.rating?2:4,e.verified||(t+=1),t}(e.landlord_reference,i)+function(e,i){if(!e||!e.records_available)return i?i.scoring.qualitative.paymentHistory.missing:2;let t=e.on_time_rate;if(i){let{paymentHistory:e}=i.scoring.qualitative;return t>=e.excellentMin?e.excellent:t>=e.goodMin?e.good:t>=e.fairMin?e.fair:e.poor}return t>=.95?0:t>=.85?1:t>=.7?2:3}(e.payment_history,i)}(e,i),r=function(e,i=s){return e<=i.decision.approvedMax?"Approved":e<=i.decision.flaggedMax?"Flagged for Review":"Denied"}(t,i);return{risk_score:t,decision:r}}(r.data,n.value);return i={id:(0,d.randomUUID)(),timestamp:new Date().toISOString(),input:r.data,risk_score:o,decision:a},l.unshift(i),l.length>50&&(l.length=50),Response.json({risk_score:o,decision:a})}catch(e){return Response.json({error:"Invalid JSON payload"},{status:400})}}async function p(){return Response.json({audits:l})}function g(e){return"number"==typeof e&&Number.isFinite(e)}let m=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/screening/route",pathname:"/api/screening",filename:"route",bundlePath:"app/api/screening/route"},resolvedPagePath:"/home/runner/work/tenant_Screen/tenant_Screen/src/app/api/screening/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:f,staticGenerationAsyncStorage:h,serverHooks:y}=m,v="/api/screening/route";function b(){return(0,a.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:h})}},9303:(e,i,t)=>{e.exports=t(517)}};var i=require("../../../webpack-runtime.js");i.C(e);var t=e=>i(i.s=e),r=i.X(0,[948],()=>t(6251));module.exports=r})();