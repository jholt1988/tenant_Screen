"use strict";(()=>{var e={};e.id=777,e.ids=[777],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8799:(e,i,t)=>{t.r(i),t.d(i,{originalPathname:()=>R,patchFetch:()=>k,requestAsyncStorage:()=>v,routeModule:()=>y,serverHooks:()=>w,staticGenerationAsyncStorage:()=>b});var r={};t.r(r),t.d(r,{GET:()=>h,POST:()=>f});var n=t(9303),o=t(8716),a=t(670);let s={thresholds:{dtiHigh:.4,affordability:{rentRule:3,partialCreditRatio:2.5,dtiMitigation:.36,dtiException:.3},credit:{excellentMin:750,goodMin:665},alternativeData:{utility:{strong:.9,moderate:.8,weak:.65}},rental:{evictionLookbackYears:5},criminal:{violentFelonyLookbackYears:10,felonyLookbackYears:7,misdemeanorLookbackYears:3}},scoring:{dtiHigh:2,affordability:{meetsRule:0,partialCredit:1,dtiException:2,fail:4},credit:{excellent:0,good:1,poor:2},rental:{evictionPoints:3,evictionOutcomePoints:{filing:1,dismissed:.5,settled:2,judgment:3.5},evictionTimeDecayFloor:.25,latePaymentsThreshold:3,latePaymentsPoints:2,excellentReferenceOffset:-1.25,satisfactoryReferenceOffset:-.5,concernReferencePoints:1.25},criminal:{cleanRecordPoints:0,staleRecordPoints:.5,recentMisdemeanorPoints:1.5,recentFelonyPoints:3,recentViolentFelonyPoints:4},employment:{fullTime:0,partTime:1,unemployed:2},alternativeData:{utilityStrongOffset:-1.25,utilityModerateOffset:-.75,utilityWeakPoints:.75}},decision:{approvedMax:2.75,flaggedMax:5.5}},l={"us-ca":{id:"us-ca",name:"California Statewide",markets:["Los Angeles","San Francisco","San Diego"],summary:"Statewide baseline that limits the use of credit history for voucher holders and requires acceptance of portable screening reports.",restrictions:{credit:{allowed:!0,requiresAlternativeEvidence:!0,notes:"SB 267 (2023) requires housing providers to offer applicants using Housing Choice Vouchers a chance to present alternative evidence of creditworthiness before denying based on credit history."},income:{requiresAlternativeEvidence:!0,portableScreeningAccepted:!0,notes:"Civil Code \xa71950.6 and SB 267 require landlords to accept reusable screening reports when offered and to evaluate voucher holders using alternative documentation instead of strict income multiples."},criminal:{allowed:!0,notes:"California places fewer statewide limits on criminal screening but defers to local ordinances; adverse action notices are still required under the ICRAA."}},references:[{title:"SB 267 (2023)",citation:"Cal. Civ. Code \xa7 1950.6 & Gov. Code \xa7 12955",url:"https://leginfo.legislature.ca.gov/faces/billTextClient.xhtml?bill_id=202320240SB267"},{title:"Tenant Screening Fee Act",citation:"Cal. Civ. Code \xa7 1950.6",url:"https://leginfo.legislature.ca.gov/faces/codes_displaySection.xhtml?lawCode=CIV&sectionNum=1950.6"}]},"us-nyc":{id:"us-nyc",name:"New York City, NY",markets:["New York City"],summary:"Implements the Fair Chance for Housing Act by deferring criminal history reviews until after a conditional offer and banning consideration of sealed or vacated records.",restrictions:{credit:{allowed:!0,requiresAlternativeEvidence:!0,notes:"The NYC Human Rights Law bars discrimination based on lawful source of income, so providers must offer non-credit alternatives when applicants rely on subsidies."},income:{maxRentMultiple:2.5,notes:"The NYC Commission on Human Rights treats high income-multiple requirements as discriminatory for voucher holders; guidance recommends capping at roughly 2.5\xd7 rent for subsidized applicants."},criminal:{allowed:!1,stage:"post-offer",disallowedCategories:["sealed records","non-convictions","adjournments in contemplation of dismissal"],notes:"Local Law 24 of 2023 (Fair Chance for Housing Act) prohibits criminal history inquiries until after a conditional offer and forbids consideration of sealed, pardoned, or vacated cases."}},references:[{title:"Fair Chance for Housing Act Guidance",citation:"NYC Local Law 24 (2023)",url:"https://www.nyc.gov/site/cchr/media/fair-chance-for-housing.page"},{title:"NYC Human Rights Law – Source of Income Protection",citation:"N.Y.C. Admin. Code \xa7 8-107(5)(a)(1)",url:"https://www1.nyc.gov/assets/cchr/downloads/pdf/publications/fairhousingbrochure.pdf"}]},"us-il-cook":{id:"us-il-cook",name:"Cook County, IL",markets:["Chicago","Cook County Suburbs"],summary:"Applies the Just Housing Amendment: criminal screens require a prequalification step and may only consider convictions from the past three years.",restrictions:{credit:{allowed:!0,notes:"Credit checks remain permitted but must be weighed with individualized assessment when paired with criminal history findings."},income:{notes:"No county-wide cap on income multiples, but housing providers must consider reasonable accommodations for subsidies."},criminal:{allowed:!0,stage:"post-offer",lookbackYears:3,disallowedCategories:["arrests","sealed or expunged records"],notes:"The Just Housing Amendment mandates a two-step process: prequalification before any criminal inquiry, and only convictions within the last three years can be weighed after an individualized assessment."}},references:[{title:"Cook County Just Housing Amendment",citation:"Cook County Code of Ordinances \xa7 42-38",url:"https://www.cookcountyil.gov/service/just-housing-ordinance"},{title:"Cook County Commission on Human Rights Regulations",citation:"Adopted Rules (2020)",url:"https://www.cookcountyil.gov/sites/g/files/ywwepo161/files/service/just_housing_amendment_rules_final.pdf"}]},"us-wa-seattle":{id:"us-wa-seattle",name:"Seattle, WA",markets:["Seattle"],summary:"Seattle’s Fair Chance Housing Ordinance bans nearly all use of criminal history in tenant screening and limits credit screening to risk-based adverse action notices.",restrictions:{credit:{allowed:!0,notes:"Providers must follow adverse action notice requirements and cannot use credit as a proxy for criminal history or source-of-income discrimination."},income:{maxRentMultiple:2.5,notes:"Seattle Office for Civil Rights recommends capping income requirements at 2.5\xd7 rent to comply with source-of-income protections for voucher holders."},criminal:{allowed:!1,disallowedCategories:["all arrests","all convictions except sex offender registry exceptions"],notes:"SMC 14.09 largely prohibits asking about or using criminal history information, with limited exceptions for adult sex offender registry checks when the housing qualifies."}},references:[{title:"Seattle Fair Chance Housing Ordinance",citation:"Seattle Municipal Code 14.09",url:"https://seattle.gov/civilrights/fair-housing/fair-chance-housing"},{title:"Fair Chance Housing FAQ",citation:"Seattle Office for Civil Rights (2021)",url:"https://seattle.gov/documents/Departments/CivilRights/FairHousing/FCH%20FAQ.pdf"}]},"us-or-portland":{id:"us-or-portland",name:"Portland, OR",markets:["Portland"],summary:"The FAIR Ordinance establishes low-barrier screening criteria with caps on income multiples and limits on credit and criminal record usage.",restrictions:{credit:{allowed:!0,requiresAlternativeEvidence:!0,notes:"Portland’s FAIR rules require landlords to accept alternative evidence of creditworthiness and prohibit denial solely for credit scores above 500 when using low-barrier screening."},income:{maxRentMultiple:2.5,notes:"Low-barrier screening caps minimum income at 2.5\xd7 the rent except for rental assistance recipients."},criminal:{allowed:!0,lookbackYears:7,disallowedCategories:["arrests not leading to conviction","expunged convictions"],notes:"Criminal screening must ignore arrests, expunged or vacated cases, and convictions older than seven years unless an individualized assessment is completed."}},references:[{title:"Fair Access in Renting (FAIR) Ordinance",citation:"Portland City Code 30.01.086",url:"https://www.portland.gov/phb/rental-services/fair-access-renting"},{title:"Administrative Rules for FAIR Ordinance",citation:"Portland Housing Bureau (2020)",url:"https://www.portland.gov/sites/default/files/2020-02/fair-administrative-rules.pdf"}]}};function c(e){if(e)return l[e]}function d(e,i=2){return Number.isFinite(e)?Number(e.toFixed(i)):"∞"}let u=[],m=require("crypto");function p(e){let i="string"==typeof e?Number(e):e;return Number.isFinite(i)?i:void 0}async function f(e){try{var i;let t=await e.json(),r=function(e){let i;let t=[],r=p(e?.income),n=p(e?.monthly_rent),o=p(e?.debt),a=p(e?.credit_score);(void 0===r||r<0)&&t.push("income must be a non-negative number"),(void 0===n||n<0)&&t.push("monthly_rent must be a non-negative number"),(void 0===o||o<0)&&t.push("debt must be a non-negative number"),(void 0===a||a<300||a>850)&&t.push("credit_score must be a number between 300 and 850");let s=e?.rental_history??{},l=p(s?.evictions),c=p(s?.late_payments);(void 0===l||l<0)&&t.push("rental_history.evictions must be a non-negative number"),(void 0===c||c<0)&&t.push("rental_history.late_payments must be a non-negative number");let d=s?.eviction_filings,u=["filed","dismissed","settled","judgment"];if(void 0!==d){if(Array.isArray(d)){for(let[e,r]of(i=[],d.entries())){let n=r?.outcome,o="string"==typeof n?n.toLowerCase():void 0,a=r?.filed_at;if(!o||!u.includes(o)){t.push(`rental_history.eviction_filings[${e}].outcome must be one of ${u.join(", ")}`);continue}if("string"!=typeof a||Number.isNaN(new Date(a).getTime())){t.push(`rental_history.eviction_filings[${e}].filed_at must be an ISO date string`);continue}i.push({outcome:o,filed_at:a})}0===i.length&&(i=void 0)}else t.push("rental_history.eviction_filings must be an array when provided")}let m=e?.criminal_background??{},f=!!m?.has_criminal_record,h=m?.type_of_crime,g=Array.isArray(m?.records)?m.records:[],y=[];g.forEach((e,i)=>{let r=e?.severity,n=e?.category,o=p(e?.years_since),a="felony"===r||"misdemeanor"===r,s=["violent","property","drug","other"].includes(n);a||t.push(`criminal_background.records[${i}].severity must be 'felony' or 'misdemeanor'`),s||t.push(`criminal_background.records[${i}].category must be one of violent, property, drug, other`),(void 0===o||o<0)&&t.push(`criminal_background.records[${i}].years_since must be a non-negative number`),a&&s&&void 0!==o&&o>=0&&y.push({severity:r,category:n,years_since:o,description:"string"==typeof e?.description?e.description:null})});let v=e?.employment_status,b=["full-time","part-time","unemployed"];return(b.includes(v)||t.push(`employment_status must be one of: ${b.join(", ")}`),t.length)?{ok:!1,errors:t}:{ok:!0,data:{income:r,monthly_rent:n,debt:o,credit_score:a,rental_history:{evictions:l,late_payments:c},criminal_background:{has_criminal_record:f,type_of_crime:"string"==typeof h?h:null,records:y.length?y:void 0},employment_status:v}}}(t);if(!r.ok)return Response.json({errors:r.errors},{status:400});let n=function(e){let i=[];if(!e||"object"!=typeof e)return{value:s,errors:i};let t=JSON.parse(JSON.stringify(s));if(e.thresholds){if(g(e.thresholds.dtiHigh)&&(t.thresholds.dtiHigh=e.thresholds.dtiHigh),e.thresholds.affordability){let i=e.thresholds.affordability;g(i.rentRule)&&(t.thresholds.affordability.rentRule=i.rentRule),g(i.partialCreditRatio)&&(t.thresholds.affordability.partialCreditRatio=i.partialCreditRatio),g(i.dtiMitigation)&&(t.thresholds.affordability.dtiMitigation=i.dtiMitigation),g(i.dtiException)&&(t.thresholds.affordability.dtiException=i.dtiException)}if(e.thresholds.credit){let i=e.thresholds.credit;g(i.excellentMin)&&(t.thresholds.credit.excellentMin=i.excellentMin),g(i.goodMin)&&(t.thresholds.credit.goodMin=i.goodMin)}if(e.thresholds.alternativeData&&e.thresholds.alternativeData.utility){t.thresholds.alternativeData||(t.thresholds.alternativeData=JSON.parse(JSON.stringify(s.thresholds.alternativeData??{utility:{strong:.9,moderate:.8,weak:.65}})));let i=e.thresholds.alternativeData.utility;g(i.strong)&&(t.thresholds.alternativeData.utility.strong=i.strong),g(i.moderate)&&(t.thresholds.alternativeData.utility.moderate=i.moderate),g(i.weak)&&(t.thresholds.alternativeData.utility.weak=i.weak)}e.thresholds.rental&&g(e.thresholds.rental.evictionLookbackYears)&&(t.thresholds.rental||(t.thresholds.rental={evictionLookbackYears:5}),t.thresholds.rental.evictionLookbackYears=e.thresholds.rental.evictionLookbackYears)}if(e.scoring){if(g(e.scoring.dtiHigh)&&(t.scoring.dtiHigh=e.scoring.dtiHigh),e.scoring.affordability){let i=e.scoring.affordability;g(i.meetsRule)&&(t.scoring.affordability.meetsRule=i.meetsRule),g(i.partialCredit)&&(t.scoring.affordability.partialCredit=i.partialCredit),g(i.dtiException)&&(t.scoring.affordability.dtiException=i.dtiException),g(i.fail)&&(t.scoring.affordability.fail=i.fail)}if(e.scoring.credit){let i=e.scoring.credit;g(i.excellent)&&(t.scoring.credit.excellent=i.excellent),g(i.good)&&(t.scoring.credit.good=i.good),g(i.poor)&&(t.scoring.credit.poor=i.poor)}if(e.scoring.rental){let i=e.scoring.rental;if(g(i.evictionPoints)&&(t.scoring.rental.evictionPoints=i.evictionPoints),g(i.latePaymentsThreshold)&&(t.scoring.rental.latePaymentsThreshold=i.latePaymentsThreshold),g(i.latePaymentsPoints)&&(t.scoring.rental.latePaymentsPoints=i.latePaymentsPoints),g(i.excellentReferenceOffset)&&(t.scoring.rental.excellentReferenceOffset=i.excellentReferenceOffset),g(i.satisfactoryReferenceOffset)&&(t.scoring.rental.satisfactoryReferenceOffset=i.satisfactoryReferenceOffset),g(i.concernReferencePoints)&&(t.scoring.rental.concernReferencePoints=i.concernReferencePoints),i.evictionOutcomePoints){let e={...t.scoring.rental.evictionOutcomePoints??s.scoring.rental.evictionOutcomePoints??{filing:t.scoring.rental.evictionPoints,dismissed:t.scoring.rental.evictionPoints,settled:t.scoring.rental.evictionPoints,judgment:t.scoring.rental.evictionPoints}},r=i.evictionOutcomePoints;g(r.filing)&&(e.filing=r.filing),g(r.dismissed)&&(e.dismissed=r.dismissed),g(r.settled)&&(e.settled=r.settled),g(r.judgment)&&(e.judgment=r.judgment),t.scoring.rental.evictionOutcomePoints=e}g(i.evictionTimeDecayFloor)&&(t.scoring.rental.evictionTimeDecayFloor=i.evictionTimeDecayFloor)}if(e.scoring.criminal){let i=e.scoring.criminal;g(i.cleanRecordPoints)&&(t.scoring.criminal.cleanRecordPoints=i.cleanRecordPoints),g(i.staleRecordPoints)&&(t.scoring.criminal.staleRecordPoints=i.staleRecordPoints),g(i.recentMisdemeanorPoints)&&(t.scoring.criminal.recentMisdemeanorPoints=i.recentMisdemeanorPoints),g(i.recentFelonyPoints)&&(t.scoring.criminal.recentFelonyPoints=i.recentFelonyPoints),g(i.recentViolentFelonyPoints)&&(t.scoring.criminal.recentViolentFelonyPoints=i.recentViolentFelonyPoints)}if(e.scoring.employment){let i=e.scoring.employment;g(i.fullTime)&&(t.scoring.employment.fullTime=i.fullTime),g(i.partTime)&&(t.scoring.employment.partTime=i.partTime),g(i.unemployed)&&(t.scoring.employment.unemployed=i.unemployed)}if(e.scoring.alternativeData){t.scoring.alternativeData||(t.scoring.alternativeData=JSON.parse(JSON.stringify(s.scoring.alternativeData??{utilityStrongOffset:0,utilityModerateOffset:0,utilityWeakPoints:0})));let i=e.scoring.alternativeData;g(i.utilityStrongOffset)&&(t.scoring.alternativeData.utilityStrongOffset=i.utilityStrongOffset),g(i.utilityModerateOffset)&&(t.scoring.alternativeData.utilityModerateOffset=i.utilityModerateOffset),g(i.utilityWeakPoints)&&(t.scoring.alternativeData.utilityWeakPoints=i.utilityWeakPoints)}}return e.decision&&(g(e.decision.approvedMax)&&(t.decision.approvedMax=e.decision.approvedMax),g(e.decision.flaggedMax)&&(t.decision.flaggedMax=e.decision.flaggedMax)),t.thresholds.credit.goodMin<=t.thresholds.credit.excellentMin||i.push("thresholds.credit.goodMin must be <= thresholds.credit.excellentMin"),t.decision.approvedMax<=t.decision.flaggedMax||i.push("decision.approvedMax must be <= decision.flaggedMax"),t.thresholds.dtiHigh>=0||i.push("thresholds.dtiHigh must be >= 0"),t.thresholds.affordability.partialCreditRatio<=t.thresholds.affordability.rentRule||i.push("thresholds.affordability.partialCreditRatio must be <= thresholds.affordability.rentRule"),t.thresholds.affordability.dtiException<=t.thresholds.affordability.dtiMitigation||i.push("thresholds.affordability.dtiException must be <= thresholds.affordability.dtiMitigation"),{value:t,errors:i}}(t?.config);if(n.errors.length)return Response.json({errors:n.errors},{status:400});let o="string"==typeof t?.jurisdiction?t.jurisdiction:void 0,a=o?c(o):void 0;if(o&&!a)return Response.json({errors:[`Unknown jurisdiction policy: ${o}`]},{status:400});let l=function(e,i=s,t){let r;let n=function(e){if(e)return"string"==typeof e?c(e):e}(t?.policy??null),o=i;if(n){let e=function(e,i){let t=JSON.parse(JSON.stringify(e)),r=[],n=[],{credit:o,income:a,criminal:s}=i.restrictions;return o&&(o.allowed&&"post-offer"!==o.stage?o.requiresAlternativeEvidence&&n.push(`${i.name}: credit review must accept alternative evidence when applicants use subsidies or portable reports.`):((0!==t.scoring.credit.excellent||0!==t.scoring.credit.good||0!==t.scoring.credit.poor)&&r.push({criteria:"credit",description:`${i.name}: credit scoring disabled because screening is ${o.allowed?"restricted to post-offer":"not permitted"} pre-offer.`}),t.scoring.credit.excellent=0,t.scoring.credit.good=0,t.scoring.credit.poor=0)),a&&("number"==typeof a.maxRentMultiple&&a.maxRentMultiple>0&&(t.thresholds.affordability.rentRule>a.maxRentMultiple&&(r.push({criteria:"income",description:`${i.name}: income-to-rent threshold reduced to ${a.maxRentMultiple}\xd7 rent per local rules.`}),t.thresholds.affordability.rentRule=a.maxRentMultiple),t.thresholds.affordability.partialCreditRatio>a.maxRentMultiple&&(t.thresholds.affordability.partialCreditRatio=a.maxRentMultiple)),a.requiresAlternativeEvidence&&n.push(`${i.name}: staff must accept alternative income or credit documentation when applicants present vouchers or reusable reports.`),a.portableScreeningAccepted&&n.push(`${i.name}: reusable screening reports must be accepted instead of running new credit pulls when they meet statutory requirements.`)),s&&(s.allowed&&"post-offer"!==s.stage||((0!==t.scoring.criminal.cleanRecordPoints||0!==t.scoring.criminal.staleRecordPoints||0!==t.scoring.criminal.recentMisdemeanorPoints||0!==t.scoring.criminal.recentFelonyPoints||0!==t.scoring.criminal.recentViolentFelonyPoints)&&r.push({criteria:"criminal",description:`${i.name}: criminal history scoring removed because checks are ${s.allowed?"limited to post-offer reviews":"not allowed"} at application.`}),t.scoring.criminal.cleanRecordPoints=0,t.scoring.criminal.staleRecordPoints=0,t.scoring.criminal.recentMisdemeanorPoints=0,t.scoring.criminal.recentFelonyPoints=0,t.scoring.criminal.recentViolentFelonyPoints=0),s.lookbackYears&&s.allowed&&n.push(`${i.name}: only convictions from the past ${s.lookbackYears} years may be considered and individualized assessments are required.`),s.disallowedCategories?.length&&n.push(`${i.name}: criminal reviews must ignore ${s.disallowedCategories.join(", ")}.`)),{config:t,adjustments:r,warnings:n}}(i,n);o=e.config,r={policyId:n.id,policyName:n.name,adjustments:e.adjustments,warnings:e.warnings}}let a=function(e,i=s){return function(e,i=s){var t;let r=[],n=function(e,i,t,r=s){let n=t>0?e/12/t:1/0,o=e<=0?1/0:i/e,a=r.thresholds.affordability,l=r.scoring.affordability;return Number.isFinite(n)&&n!==1/0?n>=a.rentRule?{ratio:n,dti:o,tier:"meets-rule",risk:l.meetsRule}:n>=a.partialCreditRatio&&o<=a.dtiMitigation?{ratio:n,dti:o,tier:"partial-credit",risk:l.partialCredit}:o<=a.dtiException?{ratio:n,dti:o,tier:"dti-exception",risk:l.dtiException}:{ratio:n,dti:o,tier:"fail",risk:l.fail}:{ratio:1/0,dti:o,tier:"meets-rule",risk:l.meetsRule}}(e.income,e.debt,e.monthly_rent,i),o={"meets-rule":{label:"Meets 3\xd7 rent affordability rule",severity:"positive"},"partial-credit":{label:"Income supports rent with supplemental documentation",severity:"warning",action:"Provide bank statements or co-signer information to support affordability."},"dti-exception":{label:"High rent burden offset by manageable debt-to-income ratio",severity:"warning",action:"Share additional proof of consistent payments or reduce revolving debt."},fail:{label:"Does not meet income-to-rent or debt-to-income rules",severity:"critical",action:"Increase stated income, add a guarantor, or seek a lower rent obligation."}}[n.tier];r.push({factor:"affordability",label:o.label,points:n.risk,severity:o.severity,dataSource:"Applicant-stated income, rent obligation, and liabilities",recommendedAction:o.action,details:{incomeToRentRatio:d(n.ratio),debtToIncomeRatio:d(n.dti)}}),n.dti>i.thresholds.dtiHigh&&r.push({factor:"dti-penalty",label:"Debt-to-income ratio exceeds maximum threshold",points:i.scoring.dtiHigh,severity:"critical",dataSource:"Credit bureau debt obligations & stated income",recommendedAction:`Reduce outstanding debt or document income that lowers DTI below ${d(i.thresholds.dtiHigh)}.`,details:{applicantDti:d(n.dti),allowedMaximum:d(i.thresholds.dtiHigh)}});let a=function(e,i){if(i){let{excellentMin:t,goodMin:r}=i.thresholds.credit;return e>=t?i.scoring.credit.excellent:e>=r?i.scoring.credit.good:i.scoring.credit.poor}return e>=750?0:e>=650?1:2}(e.credit_score,i),l=function(e,i=s){let{excellentMin:t,goodMin:r}=i.thresholds.credit;return e>=t?"excellent":e>=r?"good":"poor"}(e.credit_score,i),c={excellent:{label:"Excellent credit history",severity:"positive"},good:{label:"Good credit history with minor risk signals",severity:"warning",action:"Monitor revolving balances and ensure on-time payments to improve credit tier."},poor:{label:"Credit history indicates elevated risk",severity:"critical",action:"Address delinquencies, dispute inaccuracies, and build six months of on-time payments."}}[l];r.push({factor:"credit",label:c.label,points:a,severity:c.severity,dataSource:"Credit bureau report (FICO/VantageScore)",recommendedAction:c.action,details:{creditScore:e.credit_score,tier:l}});let u=e.rental_history;if(u.evictions>0?r.push({factor:"rental-eviction",label:"Prior eviction reported",points:i.scoring.rental.evictionPoints,severity:"critical",dataSource:"Rental court records & landlord references",recommendedAction:"Provide context, proof of resolution, or references from subsequent landlords.",details:{evictions:u.evictions}}):r.push({factor:"rental-eviction",label:"No eviction history reported",points:0,severity:"positive",dataSource:"Rental court records & landlord references",details:{evictions:u.evictions}}),u.late_payments>i.scoring.rental.latePaymentsThreshold?r.push({factor:"rental-late-payments",label:"Late rental payments exceed tolerance",points:i.scoring.rental.latePaymentsPoints,severity:"warning",dataSource:"Landlord reference checks & rental payment history",recommendedAction:"Show proof of recent on-time payments or explain historical anomalies.",details:{latePayments:u.late_payments,threshold:i.scoring.rental.latePaymentsThreshold}}):r.push({factor:"rental-late-payments",label:"Rental payment history within tolerance",points:0,severity:"positive",dataSource:"Landlord reference checks & rental payment history",details:{latePayments:u.late_payments,threshold:i.scoring.rental.latePaymentsThreshold}}),e.criminal_background.has_criminal_record){let t=function(e,i=s){var t;if(!e.has_criminal_record)return{risk:i.scoring.criminal.cleanRecordPoints,requiresIndividualReview:!1,consideredRecords:[],disregardedRecords:[],rationale:["No criminal convictions reported."]};let r=i.thresholds.criminal,n=i.scoring.criminal,o=Array.isArray(t=e.records)?t.map(e=>({severity:e.severity,category:e.category??"other",years_since:e.years_since,...void 0!==e.description&&{description:e.description}})).filter(e=>("felony"===e.severity||"misdemeanor"===e.severity)&&("violent"===e.category||"property"===e.category||"drug"===e.category||"other"===e.category)&&"number"==typeof e.years_since&&Number.isFinite(e.years_since)&&e.years_since>=0):[],a=[],l=[],c=[],d=0,u=!1;return!o.length&&e.type_of_crime?(c.push("Criminal history indicated but offense details missing. Flagged for individualized review to gather additional context."),{risk:n.staleRecordPoints,requiresIndividualReview:!0,consideredRecords:a,disregardedRecords:l,rationale:c}):(o.forEach(e=>{let i="felony"===e.severity?"violent"===e.category?r.violentFelonyLookbackYears:r.felonyLookbackYears:r.misdemeanorLookbackYears;e.years_since<=i?(a.push(e),u=!0,"felony"===e.severity?"violent"===e.category?(d+=n.recentViolentFelonyPoints,c.push(`Violent felony (${e.description??e.category}) within ${i} year lookback requires individualized assessment.`)):(d+=n.recentFelonyPoints,c.push(`Felony (${e.description??e.category}) within ${i} year lookback requires individualized assessment.`)):(d+=n.recentMisdemeanorPoints,c.push(`Misdemeanor (${e.description??e.category}) within ${i} year lookback flagged for individualized assessment.`))):(l.push(e),d+=n.staleRecordPoints,c.push(`Record (${e.description??e.category}) older than lookback window excluded from adverse action but documented for context.`))}),a.length||l.length)?{risk:d,requiresIndividualReview:u,consideredRecords:a,disregardedRecords:l,rationale:c}:(c.push("Criminal history data provided could not be validated; defaulting to individualized review."),{risk:n.staleRecordPoints,requiresIndividualReview:!0,consideredRecords:a,disregardedRecords:l,rationale:c})}(e.criminal_background,i);r.push({factor:"criminal",label:"Criminal record identified",points:t.risk,severity:"warning",dataSource:"Public records & criminal databases",recommendedAction:"Submit rehabilitation documents or expungement records for consideration.",details:{typeOfCrime:e.criminal_background.type_of_crime??null}})}else r.push({factor:"criminal",label:"No criminal record found",points:0,severity:"positive",dataSource:"Public records & criminal databases",details:{typeOfCrime:null}});let m=(t=e.employment_status,i?"full-time"===t?i.scoring.employment.fullTime:"part-time"===t?i.scoring.employment.partTime:i.scoring.employment.unemployed:"full-time"===t?0:"part-time"===t?1:2),p={"full-time":{label:"Verified full-time employment",severity:"positive"},"part-time":{label:"Part-time employment may require extra review",severity:"warning",action:"Provide pay stubs or additional income sources to document stability."},unemployed:{label:"Unemployment increases risk",severity:"critical",action:"Document alternative income, savings, or a guarantor to mitigate risk."}}[e.employment_status];r.push({factor:"employment",label:p.label,points:m,severity:p.severity,dataSource:"Employment verification & income documentation",recommendedAction:p.action,details:{status:e.employment_status}});let f=r.reduce((e,i)=>e+i.points,0),h=r.filter(e=>e.points>0).map(e=>({factor:e.factor,reason:e.label,dataSource:e.dataSource,recommendedAction:e.recommendedAction??"Contact the property manager for guidance on mitigating this finding.",points:e.points}));return{risk_score:f,contributions:r,adverseActions:h,affordability:n}}(e,i).risk_score}(e,o),l=function(e,i=s){return e<=i.decision.approvedMax?"Approved":e<=i.decision.flaggedMax?"Flagged for Review":"Denied"}(a,o);return r?{risk_score:a,decision:l,compliance:r}:{risk_score:a,decision:l}}(r.data,n.value,{policy:a}),{risk_score:f,decision:h}=l,y=function(e,i){if("Approved"===e)return null;let t="Denied"===e?"adverse":"pre-adverse";return{type:t,headline:"pre-adverse"===t?"Pre-Adverse Action Notice: Screening Results Pending":"Adverse Action Notice: Application Denied",summary:"pre-adverse"===t?"We identified potential issues in your tenant screening results. No final decision has been made. Please review the data sources below and exercise your dispute rights within the waiting period before adverse action is taken.":"Your tenant screening results led to a denial of the application. Review the data sources that contributed to this decision and contact us immediately if you need to dispute any item.",decision:e,waitingPeriodDays:"pre-adverse"===t?5:0,dataSources:[{name:"National Credit Bureau Feed",description:`Credit score ${i.credit_score} and tradeline payment history received from our integrated consumer reporting agency on the evaluation date.`,disputeRoute:"Contact the credit bureau listed on the pre-adverse notice or email compliance@tenant-screen.com to initiate a bureau dispute."},{name:"Rental Reference Repository",description:`${i.rental_history.evictions} eviction(s) and ${i.rental_history.late_payments} reported late payment(s) supplied by prior landlord references.`,disputeRoute:"Provide written documentation from the prior landlord or court records to dispute reported rental history."},{name:"Criminal Records Scan",description:i.criminal_background.has_criminal_record?`Criminal record flag for "${i.criminal_background.type_of_crime??"unspecified offense"}" returned by multi-jurisdiction search.`:"No disqualifying criminal records were located, but the database search vendor was queried.",disputeRoute:"Submit court disposition documents or expungement orders to challenge criminal record matches."},{name:"Employment & Income Verification",description:`Employment status reported as ${i.employment_status.replace("-"," ")} with stated annual income of $${i.income.toLocaleString()} and monthly rent obligation of $${i.monthly_rent.toLocaleString()}.`,disputeRoute:"Provide recent pay stubs, W-2/1099 forms, or employer letters to update income and employment information."}],disputeRights:[{title:"Request a copy of your screening report",detail:"You may obtain a free copy of the consumer report(s) relied upon within 60 days. Submit your request to our compliance team or directly to the listed data sources."},{title:"Dispute inaccurate or incomplete information",detail:"If you believe any item is inaccurate or incomplete, notify us with supporting documentation. We will forward disputes to the relevant data furnisher and pause final decisions during reinvestigation."},{title:"Reinvestigation timeline",detail:"pre-adverse"===t?"Upon receiving a dispute we will reinvestigate and respond with results within 30 days before issuing any final adverse action.":"We will reopen the application and reinvestigate within 30 days of receiving your dispute. Any corrected information will trigger an updated eligibility review."}],contact:{email:"compliance@tenant-screen.com",phone:"(800) 555-0199",address:"Tenant Screen Compliance Team, 450 Market Street, Suite 900, San Francisco, CA 94105"}}}(h,r.data);return i={id:(0,m.randomUUID)(),timestamp:new Date().toISOString(),input:r.data,risk_score:f,decision:h,compliance:l.compliance,result:{risk_score:f,decision:h,compliance:l.compliance,breakdown:void 0,adverse_actions:[]}},u.unshift(i),u.length>50&&(u.length=50),Response.json({risk_score:f,decision:h,compliance:l.compliance,notice:y})}catch(e){return Response.json({error:"Invalid JSON payload"},{status:400})}}async function h(){return Response.json({audits:u})}function g(e){return"number"==typeof e&&Number.isFinite(e)}let y=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/screening/route",pathname:"/api/screening",filename:"route",bundlePath:"app/api/screening/route"},resolvedPagePath:"/home/runner/work/tenant_Screen/tenant_Screen/src/app/api/screening/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:v,staticGenerationAsyncStorage:b,serverHooks:w}=y,R="/api/screening/route";function k(){return(0,a.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:b})}},9303:(e,i,t)=>{e.exports=t(517)}};var i=require("../../../webpack-runtime.js");i.C(e);var t=e=>i(i.s=e),r=i.X(0,[948],()=>t(8799));module.exports=r})();